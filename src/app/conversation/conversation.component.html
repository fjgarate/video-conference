<body>
  <div class="jumbotron" id="prueba">
    <div class="page-header">
      <span class="title">Conversaciones </span>
    </div>


    <div class=" w3-container" *ngIf="isDoctor">

      <div class=" w3-row list ">
        <div class="example-header">
          <input class="w3-input  w3-padding" matInput (keyup)="applyFilter($event.target.value)" placeholder="Filter">

        </div>
        <table mat-table [dataSource]="dataSource" matSort>
          <ng-container matColumnDef="select">
            <th mat-header-cell *matHeaderCellDef>
              <mat-checkbox (change)="$event ? masterToggle() : null"
                [checked]="selection.hasValue() && isAllSelected()"
                [indeterminate]="selection.hasValue() && !isAllSelected()">
              </mat-checkbox>
            </th>
            <td mat-cell *matCellDef="let row">
              <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? selection.toggle(row) : null"
                [checked]="selection.isSelected(row)">
              </mat-checkbox>
            </td>
          </ng-container>
          <!--  Columna FROM-->
          <ng-container matColumnDef="from">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>De </th>
            <td mat-cell *matCellDef="let row"> <span class="importMessage">
                <!--{{row.createName}}-->yo</span> </td>
          </ng-container>
          <!--  Columna TO-->
          <ng-container matColumnDef="otherName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Para </th>
            <td mat-cell *matCellDef="let row">
              <span class="importMessage">{{row.otherName}}</span> </td>
          </ng-container>

          <!-- Columna SUBJECT -->
          <ng-container matColumnDef="title">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Asunto </th>
            <td mat-cell *matCellDef="let row">
              <span class="importMessage">{{row.title}}</span><br>
              <div class="lastMessage w3-small">{{row.messages[row.messages.length-1].text}} </div>
            </td>
          </ng-container>

          <!-- Columna Nombre-->
          <ng-container matColumnDef="createdDate">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Fecha </th>
            <td mat-cell *matCellDef="let row">
              <span class="">{{row.messages[row.messages.length-1].createdDate| date:'short'}}</span>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns" class="encabezado"></tr>
          <tr style="cursor:pointer" mat-row *matRowDef="let row; columns: displayedColumns;"
            (click)="goMessages(row.id)">
          </tr>
        </table>
        <!-- To use pagination in DataTable  -->

        <mat-paginator #paginator [pageSize]="10" [pageSizeOptions]="[5, 10, 20]">
        </mat-paginator>


        <!-- <ul class="w3-ul w3-border list-group messages">
            <li *ngFor="let conversation of conversations " class="w3-bar list-group-item">
              <span (click)="deleteConver(conversation.id)" class="w3-bar-item w3-button w3-xlarge w3-right">
                <i class="fas fa-trash-alt"></i>
              </span>
              <span (click)="goMessages(conversation.id)" class="w3-bar-item w3-button w3-xlarge w3-right">
                <i class="fas fa-eye"></i>
              </span>
              <div class="w3-bar-item " style="width: 20%">
                <span class="importMessage w3-large">{{conversation.otherName}}</span><br>
                <div class="lastMessage">
                  {{conversation.messages[conversation.messages.length-1].createdDate| date:'short'}}</div>
              </div>
              <div class="w3-bar-item" style="width: 60%">
                <span class="importMessage w3-large">{{conversation.title}}</span><br>
                <div class="lastMessage">{{conversation.messages[conversation.messages.length-1].text}}</div>
                <span *ngIf="newMessage(conversation.messages)" style="color:red">¡Nuevos mensajes!</span>
              </div>
            </li>
          </ul>-->
        <div class="w3-container" style="margin-top:20px">

          <button (click)="toogleCollapse()" class="w3-btn w3-white w3-border w3-border-blue-grey w3-round-xlarge"
            style="margin-right:20px">
            <i class="fas fa-plus-circle" style="color:darkblue;margin-right: 5px"></i>
            <span>Nueva conversación</span>
          </button>


          <button (click)="deleteConversations()" class=" w3-btn w3-white w3-border w3-border-red w3-round-xlarge">
            <i class="fas fa-trash" style="color:darkred;margin-right: 5px"></i>
            <span>Elimar conversación</span>
          </button>

        </div>
      </div>

      <div *ngIf="!isCollapsed" class="w3-container list w3-white" style="margin-top:30px">
        <form [formGroup]="conversationForm" (ngSubmit)="createConver()">
          <div class="form-group">

        <!--  <mat-form-field>
              <label for="participants">Seleccionar paciente </label>
              <select matNativeControl required formControlName="participants">
                <option *ngFor="let patient of users" [value]="patient.id">{{patient.firstName}}
                  {{patient.lastName}}
                </option>
              </select>
            </mat-form-field>-->
            <select class="w3-select" style="width: 50%"  required formControlName="participants">
              <option value="" disabled selected>Seleccione paciente</option>
              <option *ngFor="let patient of users" [value]="patient.id">{{patient.firstName}}
                {{patient.lastName}}
              </option>
            </select>

          </div>
          <div class="form-group">
            <label for="title">Asunto</label>
            <input id="btn-input" type="text" formControlName="title" class="form-control input-sm"
              placeholder="Paciente:Francisco, Problema:Diabetes">
          </div>

          <div class="form-group">
            <label for="text">Mensaje</label>
            <!--<input id="btn-input" type="text" formControlName="text" class="form-control input-sm"
              placeholder="Mensaje">
          -->
                <textarea formControlName="text" class="w3-input w3-border w3-light-grey" type="text" placeholder="Mensaje"></textarea>
          </div>

          <div class="form-group">
            <span class="input-group-btn">
              <button class="btn btn-warning">
                Crear
              </button>
            </span>
          </div>
        </form>
      </div>
    </div>



    <div class="container" *ngIf="isPatient">
      <div class="row">
        <div class="col-sm-1 ">
        </div>
        <div class="col-sm-10 inicio">
          <ul class="list-group">
            <li *ngFor="let conversation of conversations" class="list-group-item">
              <span>{{conversation.title}}</span>
              <button (click)="deleteConver(conversation.id)" class="btn btn-outline-danger float-right"
                style="margin-left: 20px">
                Eliminar <i class="fa fa-trash"></i>
              </button>
              <button (click)="goMessages(conversation.id)" class="btn btn-outline-primary float-right"
                style="margin-left: 20px">
                Ver <i class="fa fa-arrow-right"></i>
              </button>
              <br />
              <span *ngIf="newMessage(conversation.messages)" style="color:red">¡Nuevos mensajes!</span>
            </li>

          </ul>
          <br />
        </div>
      </div>
    </div>
  </div>
</body>